cmake_minimum_required(VERSION 3.23)
project(fubuki_fuyu LANGUAGES CXX)

#------------------------------------------------------------------------------

fubuki_add_library(NAME fuyu
                      PUBLIC_DEPENDENCIES "core" "extension" "maths"
                      PRIVATE_DEPENDENCIES ""
                      HEADERS "allocation.hpp"
                              "buffer.hpp"
                              "buffer_view.hpp"
                              "command_buffer_array.hpp"
                              "command_pool.hpp"
                              "compute_pipeline.hpp"
                              "descriptor_pool.hpp"
                              "descriptor_set_layout.hpp"
                              "descriptor_set_array.hpp"
                              "device.hpp"
                              "external_handle.hpp"
                              "event.hpp"
                              "fence.hpp"
                              "framebuffer.hpp"
                              "graphics_pipeline.hpp"
                              "formatted_storage.hpp"
                              "hardware.hpp"
                              "image.hpp"
                              "image_view.hpp"
                              "instance.hpp"
                              "invoke.hpp"
                              "memory.hpp"
                              "memory_requirements.hpp"
                              "parent.hpp"
                              "physical_device.hpp"
                              "pipeline_cache.hpp"
                              "pipeline_layout.hpp"
                              "query_pool.hpp"
                              "queue.hpp"
                              "rendering_area.hpp"
                              "render_pass.hpp"
                              "sampler.hpp"
                              "sampling_rate.hpp"
                              "shader_module.hpp"
                              "shader_stage.hpp"
                              "subpass.hpp"
                              "surface.hpp"
                              "semaphore.hpp"
                              "sharing_mode.hpp"
                              "swapchain.hpp"
                              "swapchain_resources.hpp"
                              "unsupported_features.hpp"

                              "command/barrier.hpp"
                              "command/bind.hpp"
                              "command/copy.hpp"
                              "command/dispatch.hpp"
                              "command/draw.hpp"
                              "command/event.hpp"
                              "command/execute.hpp"
                              "command/manipulation.hpp"
                              "command/pipes.hpp"
                              "command/push.hpp"
                              "command/query.hpp"
                              "command/render.hpp"
                              "command/set.hpp"
                              "command/submit.hpp"
                              "command/wait_semaphore.hpp"

                              "command/pipe/adaptor_closure.hpp"
                              "command/pipe/barrier.hpp"
                              "command/pipe/bind.hpp"
                              "command/pipe/copy.hpp"
                              "command/pipe/custom.hpp"
                              "command/pipe/dispatch.hpp"
                              "command/pipe/draw.hpp"
                              "command/pipe/error.hpp"
                              "command/pipe/event.hpp"
                              "command/pipe/execute.hpp"
                              "command/pipe/manipulation.hpp"
                              "command/pipe/flow.hpp"
                              "command/pipe/push.hpp"
                              "command/pipe/query.hpp"
                              "command/pipe/record.hpp"
                              "command/pipe/render.hpp"
                              "command/pipe/set.hpp"
                              "command/pipe/submit.hpp"
                              "command/pipe/tag.hpp"

                              "debug/layer_message.hpp"
                              "debug/layers.hpp"
                              "debug/messenger.hpp"
                              "debug/name.hpp"

                              "detail/compute_pipeline_stage.hpp"
                              "detail/descriptor_pool_size.hpp"
                              "detail/formatted_storage.hpp"
                              "detail/graphics_pipeline_stage.hpp"
                              "detail/graphics_pipeline_state.hpp"
                              "detail/query_pool.hpp"
                              "detail/wait_result.hpp"

                              "functions/command_buffer.hpp"
                              "functions/command_pool.hpp"
                              "functions/buffer.hpp"
                              "functions/descriptor_pool.hpp"
                              "functions/descriptor_set.hpp"
                              "functions/device.hpp"
                              "functions/event.hpp"
                              "functions/fence.hpp"
                              "functions/instance.hpp"
                              "functions/image.hpp"
                              "functions/memory.hpp"
                              "functions/pipeline_cache.hpp"
                              "functions/query_pool.hpp"
                              "functions/queue.hpp"
                              "functions/render_pass.hpp"
                              "functions/semaphore.hpp"
                              "functions/surface.hpp"
                              "functions/swapchain.hpp"

                              "information/buffer.hpp"
                              "information/buffer_view.hpp"
                              "information/callbacks.hpp"
                              "information/command_buffer.hpp"
                              "information/command_pool.hpp"
                              "information/compute_pipeline.hpp"
                              "information/debug_messenger.hpp"
                              "information/descriptor_pool.hpp"
                              "information/descriptor_set_layout.hpp"
                              "information/descriptor_set_array.hpp"
                              "information/device.hpp"
                              "information/event.hpp"
                              "information/fence.hpp"
                              "information/framebuffer.hpp"
                              "information/graphics_pipeline.hpp"
                              "information/image.hpp"
                              "information/image_view.hpp"
                              "information/instance.hpp"
                              "information/memory.hpp"
                              "information/pipeline_cache.hpp"
                              "information/pipeline_layout.hpp"
                              "information/query_pool.hpp"
                              "information/render_pass.hpp"
                              "information/sampler.hpp"
                              "information/semaphore.hpp"
                              "information/shader_module.hpp"
                              "information/surface.hpp"
                              "information/swapchain.hpp"
                              "information/swapchain_resources.hpp"

                              "views/buffer.hpp"
                              "views/buffer_view.hpp"
                              "views/command_buffer.hpp"
                              "views/command_pool.hpp"
                              "views/compute_pipeline.hpp"
                              "views/debug_messenger.hpp"
                              "views/descriptor_pool.hpp"
                              "views/descriptor_set_layout.hpp"
                              "views/descriptor_set_array.hpp"
                              "views/device.hpp"
                              "views/device_ref.hpp"
                              "views/event.hpp"
                              "views/fence.hpp"
                              "views/framebuffer.hpp"
                              "views/image.hpp"
                              "views/image_view.hpp"
                              "views/instance.hpp"
                              "views/instance_ref.hpp"
                              "views/graphics_pipeline.hpp"
                              "views/memory.hpp"
                              "views/owning.hpp"
                              "views/pipeline_cache.hpp"
                              "views/pipeline_layout.hpp"
                              "views/query_pool.hpp"
                              "views/render_pass.hpp"
                              "views/sampler.hpp"
                              "views/semaphore.hpp"
                              "views/shader_module.hpp"
                              "views/surface.hpp"
                              "views/swapchain.hpp"
                              "views/swapchain_resources.hpp"

                      SOURCES "allocation.cpp"
                              "buffer.cpp"
                              "buffer_view.cpp"
                              "command_buffer_array.cpp"
                              "command_pool.cpp"
                              "compute_pipeline.cpp"
                              "descriptor_pool.cpp"
                              "descriptor_set_layout.cpp"
                              "descriptor_set_array.cpp"
                              "device.cpp"
                              "event.cpp"
                              "fence.cpp"
                              "framebuffer.cpp"
                              "graphics_pipeline.cpp"
                              "hardware.cpp"
                              "image.cpp"
                              "image_view.cpp"
                              "instance.cpp"
                              "memory.cpp"
                              "parent.cpp"
                              "pipeline_cache.cpp"
                              "pipeline_layout.cpp"
                              "query_pool.cpp"
                              "render_pass.cpp"
                              "semaphore.cpp"
                              "shader_module.cpp"
                              "surface.cpp"
                              "sampler.cpp"
                              "swapchain.cpp"
                              "swapchain_resources.cpp"

                              "command/barrier.cpp"
                              "command/bind.cpp"
                              "command/copy.cpp"
                              "command/dispatch.cpp"
                              "command/draw.cpp"
                              "command/event.cpp"
                              "command/execute.cpp"
                              "command/manipulation.cpp"
                              "command/push.cpp"
                              "command/query.cpp"
                              "command/render.cpp"
                              "command/set.cpp"
                              "command/submit.cpp"

                              "debug/layers.cpp"
                              "debug/messenger.cpp"

                              "detail/formatted_storage.cpp"

                              "functions/command_buffer.cpp"
                              "functions/command_pool.cpp"
                              "functions/buffer.cpp"
                              "functions/descriptor_pool.cpp"
                              "functions/descriptor_set.cpp"
                              "functions/event.cpp"
                              "functions/fence.cpp"
                              "functions/image.cpp"
                              "functions/memory.cpp"
                              "functions/pipeline_cache.cpp"
                              "functions/query_pool.cpp"
                              "functions/queue.cpp"
                              "functions/render_pass.cpp"
                              "functions/semaphore.cpp"
                              "functions/surface.cpp"
                              "functions/swapchain.cpp"

                      PUBLIC_LINK "${Vulkan_LIBRARIES}"
                      PRIVATE_LINK ""
                      SYSTEM_PUBLIC_LINK ""
                      SYSTEM_PRIVATE_LINK ""
                  )

#In debug builds with Mingw, we get 'string table overflow at offset ...' when compiling a variant in
#formatted_storage_test.cpp, probably because we have several **big** variants.
#https://stackoverflow.com/questions/14125007/gcc-string-table-overflow-error-during-compilation/14601779
if(MINGW AND CMAKE_CXX_COMPILER_ID STREQUAL "GNU" AND CMAKE_BUILD_TYPE STREQUAL "Debug")
    target_compile_options(fubuki_fuyu PUBLIC "-O2")
endif()

# Ideally, I'd like to perform static analysis here too, but it looks like my i9 14900KF isn't enough
# to complete it by the end of the universe lifespan...
# I'm thus disabling clang-tidy for this(these) source(s)
set_source_files_properties(detail/formatted_storage.cpp PROPERTIES SKIP_LINTING ON)
set_source_files_properties(detail/formatted_storage.hpp PROPERTIES SKIP_LINTING ON)
set_source_files_properties(formatted_storage.hpp PROPERTIES SKIP_LINTING ON)
